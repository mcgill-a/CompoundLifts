{% extends "base.html" %}
{% set active_page = 'athletes' %}
{% block content %}
	<br />
	<div class="no-padding container">
		<br />
		<div class="settings">
			<div class="settings-list">
				<ul>
					<li>Profile</li>
					<li>Lifts</li>
				</ul>
			</div>
			<div class="settings-content">
				<p>Lifts</p>
				<!--<table id="deadlift" class="table table-striped table-bordered table-hover">
					<thead class="thead-dark">
						<tr>
							<th>#</th>
							<th>DATE</th>
							<th>WEIGHT (KG)</th>
							<th>DESCRIPTION</th>
							<th>VIDEO URL</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>10/10/2018</td>
							<td>140</td>
							<td>Something here</td>
							<td>https://www.youtube.com/</td>
						</tr>
						<tr>
							<td>2</td>
							<td>05/10/2018</td>
							<td>130</td>
							<td>Something here</td>
							<td>https://www.youtube.com/</td>
						</tr>
					</tbody>
				</table>
				<p>Bench</p>
				<table id="bench" class="table table-striped table-bordered table-hover">
					<thead class="thead-dark">
						<tr>
							<th>#</th>
							<th>DATE</th>
							<th>WEIGHT (KG)</th>
							<th>DESCRIPTION</th>
							<th>VIDEO URL</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>10/10/2018</td>
							<td>90</td>
							<td>Something here</td>
							<td>https://www.youtube.com/</td>
						</tr>
					</tbody>
				</table>
				<p>Squat</p>
				<table id="squat" class="table table-striped table-bordered table-hover">
				<thead class="thead-dark">
					<tr>
						<th>#</th>
						<th>DATE</th>
						<th>WEIGHT (KG)</th>
						<th>DESCRIPTION</th>
						<th>VIDEO URL</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>1</td>
						<td>10/10/2018</td>
						<td>125</td>
						<td>Something here</td>
						<td>https://www.youtube.com/</td>
					</tr>
				</tbody>
			</table>
			</div>
		</div>
		{#<div class="edit-profile">
			<div class="info-banner">
				<img class="profile-pic" src='{{athlete.profile_pic|e}}' width=120px height=120px/>
				<div class="details">
					<h1>{{athlete.first_name}} {{athlete.last_name}}</h1>
					<h2>{{athlete.email}}</h2>
				</div>
			</div>
		</div>#}
		<br />-->
		
		<div class="table-wrapper">
			<div class="table-title">
				<div class="row">
					<div class="col-sm-8"><h2>Deadlift</h2></div>
					<div class="col-sm-4">
						<button type="button" class="btn btn-info add-new"><i class="fa fa-plus"></i> Add New</button>
					</div>
				</div>
			</div>
			<table class="table table-bordered">
				<thead>
					<tr>
						<th width="170px">Date</th>
						<th width="100px">Weight (KG)</th>
						<th width="250px">Video URL</th>
						<th width="300px">Description</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% if deadlifts is not none %}
						{% for lift in deadlifts %}
							<tr>
								<td>{{lift['date']}}</td>
								<td>{{lift['weight']}}</td>
								<td>{{lift['video_url']}}</td>
								<td>{{lift['description']}}</td>
								<td>
									<a class="add" title="Confirm" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-ok"></i></a>
									<a class="edit" title="Edit" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-pencil"></i></a>
									<a class="delete" title="Delete" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-remove"></i></a>
								</td>
							</tr>
						{% endfor %}
					{% endif %}
				</tbody>
			</table>
		</div>
	</div>
	<script type="text/javascript">
		$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();
			var actions = '<a class="add" title="Confirm" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-ok"></i></a>' +
							'<a class="edit" title="Edit" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-pencil"></i></a>' +
							'<a class="delete" title="Delete" data-toggle="tooltip"><i class="material-icons"><span class="glyphicon glyphicon-remove"></i></a>'
			// Append table with add row form on add new button click
			$(".add-new").click(function(){
				$(this).attr("disabled", "disabled");
				var index = $("table tbody tr:last-child").index();
				var row = '<tr>' +
					'<td><input type="date" class="form-control" name="date" placeholder="Date" id="date" required></td>' +
					'<td><input type="number" min="0" max="1200" class="form-control" name="weight" placeholder="Weight" id="weight" required></td>' +
					'<td><input type="url" class="form-control url" name="video_url" placeholder="Video URL" id="video_url"></td>' +
					'<td><input type="text" class="form-control" name="description" placeholder="Description" id="description" required></td>' +
					'<td>' + actions + '</td>' +
				'</tr>';
				$("table").append(row);		
				$("table tbody tr").eq(index + 1).find(".add, .edit").toggle();
				$('[data-toggle="tooltip"]').tooltip();
			});
			// Add row on add button click
			$(document).on("click", ".add", function(){
				var empty = false;
				var input = $(this).parents("tr").find('input');
				input.each(function(){
					if(!$(this).val()){
						if(!$(this).hasClass("url"))
						{
							$(this).addClass("error");
							empty = true;
						}
						
					} else{
						$(this).removeClass("error");
					}
				});
				$(this).parents("tr").find(".error").first().focus();
				if(!empty){
					input.each(function(){
						$(this).parent("td").html($(this).val());
					});			
					$(this).parents("tr").find(".add, .edit").toggle();
					$(".add-new").removeAttr("disabled");
				}
				
				// POST NEW TABLE ROW TO DB
				var output = [];
				input.each(function(){
					output.push($(this).val());
				});
				// Match format with existing DB date time
				//var date = new Date(output[0]);
				
				var lift = {
					'date' : output[0],
					'weight' : parseInt(output[1]),
					'video_url' : output[2],
					'description' : output[3]
				}
				
				$.ajax({
					type : "POST",
					url : "/lifts/add/",
					data: JSON.stringify(lift),
					contentType: 'application/json;charset=UTF-8',
					success: function(result) {
						console.log("Added Lift: " + result);
					}
				});
			});
			// Edit row on edit button click
			$(document).on("click", ".edit", function(){		
				$(this).parents("tr").find("td:not(:last-child)").each(function(){
					$(this).html('<input type="text" class="form-control" value="' + $(this).text() + '">');
				});		
				$(this).parents("tr").find(".add, .edit").toggle();
				$(".add-new").attr("disabled", "disabled");
			});
			// Delete row on delete button click
			$(document).on("click", ".delete", function(){
				$(this).parents("tr").remove();
				$(".add-new").removeAttr("disabled");
			});
		});
	</script>
{% endblock %}
