{% extends "base.html" %}
{% set active_page = "athletes" %}
{% block content %}
	<br />
	<div class="athlete no-padding container ">
		<br />
		<div class="cover-pic" style="background: url({{cover_pic|e}});">

		</div>
		
		<div>
			{% include 'includes/_messages.html' %}
			<div class="top">
				<div class="social">
					<img class="profile-pic" src='{{profile_pic|e}}' width=200px height=200px/>	
					<div class="follow">
						<div class="followers">
							<a id="follower-count" href="#">{{athlete.followers | length}}</a>
							<p>Followers</p>
						</div>
						<div class="following">
							<a id="following-count" href="#">{{athlete.following | length}}</a>
							<p>Following</p>
						</div>
					</div>
					{% if current_user is not none and athlete._id != current_user._id %}
						{% if athlete._id|string in current_user.following %}
							<button class="unfollow-btn" type="submit" name="{{athlete._id|string}}"></button>
						{% else %}
							<button class="follow-btn" type="submit" name="{{athlete._id|string}}"></button>
						{% endif %}
					{% endif %}
				</div>
				<div class="split">
					<div class="breadcrumb">
						<p><a href="/">Home</a> > <a href="/athletes/">Athletes</a> > <a href="/athletes/{{athlete._id}}">{{athlete.first_name}} {{athlete.last_name}}</a></p>
					</div>
					<div class="info">
						<h1>{{athlete.first_name}} {{athlete.last_name}}</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="athlete-tabs">
			<div class="tab active">
				<button onclick="openTab('tab-overview');">Overview</button>
			</div>
			<div class="tab">
				<button onclick="openTab('tab-followers');">Followers</button>
			</div>
			<div class="tab">
				<button onclick="openTab('tab-following');">Following</button>
			</div>
		</div>
		<div id="tab-overview" class="tab-content">
			<p>Overview</p>
		</div>
		<div id="tab-followers" class="tab-content" style="display: none;">
			<p>Followers</p>
		</div>
		<div id="tab-following" class="tab-content" style="display: none;">
			<p>Following</p>
		</div>


		{% if user_lifts is not none %}
		<div class="featured">
			<div class="title">
				<h1>LIFTS</h1>
			</div>
			<div class="cards">
				{% if deadlift_max is not none %}
					<div class="card">
						<img src="/static/resources/lifts/deadlift.jpg">
						<p class="weight">{{deadlift_max['weight']}} KG</p>
						<h2>DEADLIFT</h2>
					</div>
				{% endif %}
				{% if bench_max is not none %}
					<div class="card">
						<img src="/static/resources/lifts/bench.jpg">
						<p class="weight">{{bench_max['weight']}} KG</p>
						<h2>BENCH</h2>
					</div>
				{% endif %}
				{% if squat_max is not none %}
				<div class="card">
					<img src="/static/resources/lifts/squat2.jpg">
					<p class="weight">{{squat_max['weight']}}  KG</p>
					<h2>SQUAT</h2>
				</div>
				{% endif %}
			</div>
		</div>
		{% endif %}
		<br />
	</div>
	<script>
		$(document).ready(function(){
			$("button.follow-btn").on('click', function(){
				var id = $(this).attr('name');

				if ( $(this).hasClass("follow-btn"))
				{
					$.ajax({
						type : "POST",
						url : "/follow/",
						data: id,
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log("Followed user: " + result);
						}
					});
					$('#follower-count').html(function(i, val) { return +val+1 });
					$(this).removeClass('follow-btn').addClass('unfollow-btn');
				}
				else
				{
					$.ajax({
						type : "POST",
						url : "/unfollow/",
						data: id,
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log("Unfollowed user: " + result);
						}
					});
					$('#follower-count').html(function(i, val) { return +val-1 });
					$(this).removeClass('unfollow-btn').addClass('follow-btn');
				}
			});

			$("button.unfollow-btn").on('click', function(){
				var id = $(this).attr('name');
				
				if ( $(this).hasClass("unfollow-btn"))
				{
					$.ajax({
						type : "POST",
						url : "/unfollow/",
						data: id,
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log("Unfollowed user: " + result);
						}
					});
					$('#follower-count').html(function(i, val) { return +val-1 });
					$(this).removeClass('unfollow-btn').addClass('follow-btn');
				}
				else
				{
					$.ajax({
						type : "POST",
						url : "/follow/",
						data: id,
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log("Followed user: " + result);
						}
					});
					$('#follower-count').html(function(i, val) { return +val+1 });
					$(this).removeClass('follow-btn').addClass('unfollow-btn');
				}
			});
		});
	</script>
{% endblock %}
